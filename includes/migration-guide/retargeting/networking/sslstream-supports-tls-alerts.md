### <a name="sslstream-supports-tls-alerts"></a>SslStream で TLS アラートに対応

|   |   |
|---|---|
|説明|TLS ハンドシェイクに失敗すると、最初の I/O 読み取り/書き込み操作によって <xref:System.IO.IOException?displayProperty=name> と内部例外 <xref:System.ComponentModel.Win32Exception?displayProperty=name> がスローされます。 <xref:System.ComponentModel.Win32Exception?displayProperty=name> の <xref:System.ComponentModel.Win32Exception.NativeErrorCode?displayProperty=name> コードは、この [Schannel ドキュメント](https://msdn.microsoft.com/library/windows/desktop/dd721886%28v=vs.85%29.aspx)に関するページを利用してリモート側から TLS アラートにマッピングできます。詳細については、「[RFC 2246: Section 7.2.2 Error alerts](https://tools.ietf.org/html/rfc2246#section-7.2.2)」(RFC 2246: Section 7.2.2 エラー アラート) を参照してください。.NET 4.6.2 以前の場合、相手がハンドシェイクに失敗した直後、接続を拒否した場合、書き込みまたは読み込み中にトランスポート チャネル (通常、TCP 接続) がタイムアウトになります。|
|提案される解決策|<xref:System.IO.Stream.Read(System.Byte[],System.Int32,System.Int32)>/<xref:System.IO.Stream.Write(System.Byte[],System.Int32,System.Int32)> など、ネットワーク I/O API を呼び出すアプリケーションに <xref:System.IO.IOException> または <xref:System.TimeoutException?displayProperty=name> を処理させてください。.NET 4.7 以降、TLS アラート機能は既定で有効になっています。 .NET 4.0 を対象にするアプリケーション - .NET 4.7 以降で実行している .NET 4.6.2 の場合、互換性を維持するためにこの機能が無効になります。.NET 4.7 以降のフレームワークを実行している .NET 4.6 以上のアプリケーションでは、次の構成 API を利用し、この機能を有効または無効にできます。<ul><li>プログラムによる:</li></ul>ServicePointManager は 1 回のみ初期化するため、アプリケーションで行われる一番最初の動作にする必要があります。<pre><code class="language-C#">AppContext.SetSwitch(&quot;TestSwitch.LocalAppContext.DisableCaching&quot;, true);&#13;&#10;AppContext.SetSwitch(&quot;Switch.System.Net.DontEnableTlsAlerts&quot;, true); // Set to &#39;false&#39; to enable the feature in .NET 4.6 - 4.6.2.&#13;&#10;</code></pre><ul><li>AppConfig:</li></ul><pre><code class="language-XML">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Net.DontEnableTlsAlerts=true&quot;/&gt;&#13;&#10;&lt;!-- Set to &#39;false&#39; to enable the feature in .NET 4.6 - 4.6.2. --&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre><ul><li>レジストリ キー (マシン グローバル):</li></ul>値を 'false' に設定すると、.NET 4.6 - 4.6.2 でこの機能が有効になります。<pre><code>Key = HKLM\SOFTWARE\[Wow6432Node\]Microsoft\.NETFramework\AppContext\Switch.System.Net.DontEnableTlsAlerts&#13;&#10;Type = String&#13;&#10;Value = &quot;true&quot;&#13;&#10;</code></pre>|
|スコープ|エッジ|
|Version|4.7|
|型|再ターゲット中|
|影響を受ける API|<ul><li><xref:System.Net.Security.SslStream?displayProperty=nameWithType></li><li><xref:System.Net.WebRequest?displayProperty=nameWithType></li><li><xref:System.Net.HttpWebRequest?displayProperty=nameWithType></li><li><xref:System.Net.FtpWebRequest?displayProperty=nameWithType></li><li><xref:System.Net.Mail.SmtpClient?displayProperty=nameWithType></li><li><xref:System.Net.Http?displayProperty=nameWithType></li></ul>|

