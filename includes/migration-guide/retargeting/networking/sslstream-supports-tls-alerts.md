### <a name="sslstream-supports-tls-alerts"></a><span data-ttu-id="b4803-101">SslStream で TLS アラートに対応</span><span class="sxs-lookup"><span data-stu-id="b4803-101">SslStream supports TLS Alerts</span></span>

|   |   |
|---|---|
|<span data-ttu-id="b4803-102">説明</span><span class="sxs-lookup"><span data-stu-id="b4803-102">Details</span></span>|<span data-ttu-id="b4803-103">TLS ハンドシェイクに失敗すると、最初の I/O 読み取り/書き込み操作によって <xref:System.IO.IOException?displayProperty=name> と内部例外 <xref:System.ComponentModel.Win32Exception?displayProperty=name> がスローされます。</span><span class="sxs-lookup"><span data-stu-id="b4803-103">After a failed TLS handshake, an <xref:System.IO.IOException?displayProperty=name> with an inner <xref:System.ComponentModel.Win32Exception?displayProperty=name> exception will be thrown by the first I/O Read/Write operation.</span></span> <span data-ttu-id="b4803-104"><xref:System.ComponentModel.Win32Exception?displayProperty=name> の <xref:System.ComponentModel.Win32Exception.NativeErrorCode?displayProperty=name> コードは、この [Schannel ドキュメント](https://msdn.microsoft.com/library/windows/desktop/dd721886%28v=vs.85%29.aspx)に関するページを利用してリモート側から TLS アラートにマッピングできます。詳細については、「[RFC 2246: Section 7.2.2 Error alerts](https://tools.ietf.org/html/rfc2246#section-7.2.2)」(RFC 2246: Section 7.2.2 エラー アラート) を参照してください。.NET 4.6.2 以前の場合、相手がハンドシェイクに失敗した直後、接続を拒否した場合、書き込みまたは読み込み中にトランスポート チャネル (通常、TCP 接続) がタイムアウトになります。</span><span class="sxs-lookup"><span data-stu-id="b4803-104">The <xref:System.ComponentModel.Win32Exception.NativeErrorCode?displayProperty=name> code for the <xref:System.ComponentModel.Win32Exception?displayProperty=name> can be mapped to the TLS Alert from the remote party using this [Schannel documentation](https://msdn.microsoft.com/library/windows/desktop/dd721886%28v=vs.85%29.aspx).For more information, see [RFC 2246: Section 7.2.2 Error alerts](https://tools.ietf.org/html/rfc2246#section-7.2.2)The behavior in .NET 4.6.2 and below is that the transport channel (usually TCP connection) will timeout during either Write or Read if the other party failed the handshake and immediately afterwards rejected the connection.</span></span>|
|<span data-ttu-id="b4803-105">提案される解決策</span><span class="sxs-lookup"><span data-stu-id="b4803-105">Suggestion</span></span>|<span data-ttu-id="b4803-106"><xref:System.IO.Stream.Read(System.Byte[],System.Int32,System.Int32)>/<xref:System.IO.Stream.Write(System.Byte[],System.Int32,System.Int32)> など、ネットワーク I/O API を呼び出すアプリケーションに <xref:System.IO.IOException> または <xref:System.TimeoutException?displayProperty=name> を処理させてください。.NET 4.7 以降、TLS アラート機能は既定で有効になっています。</span><span class="sxs-lookup"><span data-stu-id="b4803-106">Applications calling network I/O APIs such as <xref:System.IO.Stream.Read(System.Byte[],System.Int32,System.Int32)>/<xref:System.IO.Stream.Write(System.Byte[],System.Int32,System.Int32)> should handle <xref:System.IO.IOException> or <xref:System.TimeoutException?displayProperty=name>.The TLS Alerts feature is enabled by default starting with .NET 4.7.</span></span> <span data-ttu-id="b4803-107">.NET 4.0 を対象にするアプリケーション - .NET 4.7 以降で実行している .NET 4.6.2 の場合、互換性を維持するためにこの機能が無効になります。.NET 4.7 以降のフレームワークを実行している .NET 4.6 以上のアプリケーションでは、次の構成 API を利用し、この機能を有効または無効にできます。</span><span class="sxs-lookup"><span data-stu-id="b4803-107">Applications targeting .NET 4.0 - .NET 4.6.2 running on a .NET 4.7 or higher system will have the feature disabled to preserve compatibility.The following configuration API is available to enable or disable the feature for .NET 4.6 and above applications running on .NET 4.7 or higher framework.</span></span><ul><li><span data-ttu-id="b4803-108">プログラムによる:</span><span class="sxs-lookup"><span data-stu-id="b4803-108">Programmatically:</span></span></li></ul><span data-ttu-id="b4803-109">ServicePointManager は 1 回のみ初期化するため、アプリケーションで行われる一番最初の動作にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="b4803-109">Must be the very first thing the application does since ServicePointManager will initialize only once:</span></span><pre><code class="language-C#">AppContext.SetSwitch(&quot;TestSwitch.LocalAppContext.DisableCaching&quot;, true);&#13;&#10;AppContext.SetSwitch(&quot;Switch.System.Net.DontEnableTlsAlerts&quot;, true); // Set to &#39;false&#39; to enable the feature in .NET 4.6 - 4.6.2.&#13;&#10;</code></pre><ul><li><span data-ttu-id="b4803-110">AppConfig:</span><span class="sxs-lookup"><span data-stu-id="b4803-110">AppConfig:</span></span></li></ul><pre><code class="language-XML">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Net.DontEnableTlsAlerts=true&quot;/&gt;&#13;&#10;&lt;!-- Set to &#39;false&#39; to enable the feature in .NET 4.6 - 4.6.2. --&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre><ul><li><span data-ttu-id="b4803-111">レジストリ キー (マシン グローバル):</span><span class="sxs-lookup"><span data-stu-id="b4803-111">Registry key (machine global):</span></span></li></ul><span data-ttu-id="b4803-112">値を 'false' に設定すると、.NET 4.6 - 4.6.2 でこの機能が有効になります。</span><span class="sxs-lookup"><span data-stu-id="b4803-112">Set the Value to 'false' to enable the feature in .NET 4.6 - 4.6.2.</span></span><pre><code>Key = HKLM\SOFTWARE\[Wow6432Node\]Microsoft\.NETFramework\AppContext\Switch.System.Net.DontEnableTlsAlerts&#13;&#10;Type = String&#13;&#10;Value = &quot;true&quot;&#13;&#10;</code></pre>|
|<span data-ttu-id="b4803-113">スコープ</span><span class="sxs-lookup"><span data-stu-id="b4803-113">Scope</span></span>|<span data-ttu-id="b4803-114">エッジ</span><span class="sxs-lookup"><span data-stu-id="b4803-114">Edge</span></span>|
|<span data-ttu-id="b4803-115">Version</span><span class="sxs-lookup"><span data-stu-id="b4803-115">Version</span></span>|<span data-ttu-id="b4803-116">4.7</span><span class="sxs-lookup"><span data-stu-id="b4803-116">4.7</span></span>|
|<span data-ttu-id="b4803-117">型</span><span class="sxs-lookup"><span data-stu-id="b4803-117">Type</span></span>|<span data-ttu-id="b4803-118">再ターゲット中</span><span class="sxs-lookup"><span data-stu-id="b4803-118">Retargeting</span></span>|
|<span data-ttu-id="b4803-119">影響を受ける API</span><span class="sxs-lookup"><span data-stu-id="b4803-119">Affected APIs</span></span>|<ul><li><xref:System.Net.Security.SslStream?displayProperty=nameWithType></li><li><xref:System.Net.WebRequest?displayProperty=nameWithType></li><li><xref:System.Net.HttpWebRequest?displayProperty=nameWithType></li><li><xref:System.Net.FtpWebRequest?displayProperty=nameWithType></li><li><xref:System.Net.Mail.SmtpClient?displayProperty=nameWithType></li><li><xref:System.Net.Http?displayProperty=nameWithType></li></ul>|

